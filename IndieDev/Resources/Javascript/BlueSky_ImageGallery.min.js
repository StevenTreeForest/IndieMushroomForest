"use strict";function ThumbNailLinkCheck(){try{const targetTagName=".img_thumbnails",img=$(targetTagName);console.assert(img.length>0,"Failed: img.length>0",img),img.hide()}catch(error){console.error(`${error}.\n ${error.stack}`)}}function getSavedPostArray(){try{const currentPageDate=GetPageDate().toISOString().split("T")[0];let data_savedPost=JSON.parse(localStorage.getItem(keyName_SavedPost));return void 0!==data_savedPost&&null!=data_savedPost||(data_savedPost=[]),console.assert(!(void 0===data_savedPost||null==data_savedPost),"Failed: !(typeof data_savedPost === undefined)",data_savedPost),data_savedPost}catch(error){console.error(`${error}.\n ${error.stack}`)}}function removePostInSavedPost(link_post){try{let data_savedPost=getSavedPostArray(),data_new=[],found=!1;for(let i=0;i<data_savedPost.length;i++){let post_now=data_savedPost[i];post_now.postLink!=link_post&&data_new.push(post_now)}localStorage.setItem(keyName_SavedPost,JSON.stringify(data_new))}catch(error){console.error(`${error}.\n ${error.stack}`)}}function ShowNumSavedPost(){try{let list_savedPost;const links_savedPost=getSavedPostArray().map(x=>x.postLink);let $allPostLink=$("#panel_displayContainer").find("a");const list_href_pagePost=$allPostLink.map(x=>$($allPostLink[x]).attr("href")),dataSet=new Set(links_savedPost);let count=0,$numSavedPost;for(const t of list_href_pagePost)dataSet.has(t)&&count++;$(".NumSavedPost").text(count)}catch(error){console.error(`${error}.\n ${error.stack}`)}}function ShowSavedPost(){try{return void ShowNumSavedPost();var $gallery,$closeButton}catch(error){console.error(`${error}.\n ${error.stack}`)}}function CheckSavedPostDateInfo(){try{console.log("CheckSavedPostDateInfo");let list_savedPost=getSavedPostArray();const count_before=list_savedPost.length;let $allPostLink=$("#panel_displayContainer").find("a");const list_href_pagePost=$allPostLink.map(x=>$($allPostLink[x]).attr("href")),pageDate=GetPageDate(),hashSet_href_pagePost=new Set(list_href_pagePost);let newResult=[];for(let savedPost_raw of list_savedPost){var savedPost_new=new DEF_SavedPostEntry;Object.assign(savedPost_new,savedPost_raw),hashSet_href_pagePost.has(savedPost_new.postLink)&&(savedPost_new.HasPostDateInfo()||(savedPost_new.postDate=pageDate.toISOString().split("T")[0])),console.assert(savedPost_new.IsValid(),"Failed: savedPost_new.IsValid()",savedPost_new),savedPost_new.IsValid()&&newResult.push(savedPost_new)}console.assert(newResult.length==count_before,`Failed: newResult.length(${newResult.length})== count_before(${count_before})`),localStorage.setItem(keyName_SavedPost,JSON.stringify(newResult))}catch(error){console.error(`${error}.\n ${error.stack}`)}}function checkLinksExist(){try{function hideNotExistLink(id_link){const $link_next=$(id_link),url_test=$link_next.attr("href");fetch(url_test).then(res=>{res.ok?$link_next.show():$link_next.hide()}).catch(()=>{$("#"+id_link).hide()})}hideNotExistLink(".link_next_page"),hideNotExistLink(".link_previous_page")}catch(error){console.error(`${error}.\n ${error.stack}`)}}function GetPageDate(){try{const path=window.location.pathname,fileName=path.substring(path.lastIndexOf("/")+1),baseName=fileName.replace(/\.[^/.]+$/,""),parts=baseName.split("_"),dateParts=parts.slice(-3),formatted=dateParts.join("-"),date=new Date(formatted);return date}catch(error){console.error(`${error}.\n ${error.stack}`)}}function AddSavedPost(tag_link){try{console.assert(tag_link instanceof HTMLAnchorElement,"Failed:  (tag_link instanceof HTMLAnchorElement)",tag_link);const $tag_link=$(tag_link);let href=$tag_link.attr("href");var $imgs=$tag_link.find("img");console.assert($imgs.length>0,"Failed: $imgs.length>0",$tag_link);let imgLinks=$imgs.map((function(){return $(this).attr("src")})).get();console.assert(imgLinks.length>0,"Failed: imgLinks.length>0",$tag_link);var entry=new DEF_SavedPostEntry;Object.preventExtensions(entry),entry.postLink=href,entry.imgLinks=imgLinks,entry.postDate=GetPageDate().toISOString().split("T")[0],keyName_SavedPost in localStorage||localStorage.setItem(keyName_SavedPost,JSON.stringify([])),removePostInSavedPost(entry.postLink);let data_savedPost=getSavedPostArray();data_savedPost.push(entry),localStorage.setItem(keyName_SavedPost,JSON.stringify(data_savedPost)),ShowSavedPost()}catch(error){console.error(`${error}.\n ${error.stack}`)}}function DisplaySaveButtonColor(entryDiv){try{console.assert(entryDiv instanceof Object,"Failed: entryDiv instaceof Object",entryDiv);let $div_this=$(entryDiv);console.assert($div_this.hasClass("entryDiv"),"Failed: $div_this.hasClass(.entryDiv)",entryDiv);let href=$div_this.find("a").attr("href"),list_savedPost=getSavedPostArray();$div_this.find(".saveIcon svg").attr("fill","gray");for(let index=0;index<list_savedPost.length;index++){const post=list_savedPost[index];if(post.postLink==href){$div_this.find(".saveIcon svg").attr("fill","red");break}}}catch(error){console.error(`${error}.\n ${error.stack}`)}}function Adjust_EntryDiv(){try{var list_entryDiv=$(".entryContainer .entryDiv");let observer=new IntersectionObserver(entries=>{entries.forEach(entry=>{entry.isIntersecting&&DisplaySaveButtonColor(entry.target)})},{root:null,threshold:.1});list_entryDiv.each(index=>{var newIcon;observer.observe(list_entryDiv.get(index)),$("#Icon_Heart").clone().attr({class:"saveIcon"}).removeAttr("id","").appendTo($(list_entryDiv.eq(index))).on("click",(function(){let $div_this;var href_post=$(this).parent().find("a").get(0);let list_savedPost=getSavedPostArray(),isSaved=!1;for(let index=0;index<list_savedPost.length;index++){var data_post;if(list_savedPost[index].postLink==href_post){isSaved=!0;break}}isSaved?(removePostInSavedPost(href_post),ShowSavedPost()):AddSavedPost(href_post),DisplaySaveButtonColor($(this).parent())}))})}catch(error){console.error(`${error}.\n ${error.stack}`)}}!function(){try{ThumbNailLinkCheck(),checkLinksExist(),Adjust_EntryDiv(),ShowSavedPost(),CheckSavedPostDateInfo()}catch(error){console.error(`${error}.\n ${error.stack}`)}}();