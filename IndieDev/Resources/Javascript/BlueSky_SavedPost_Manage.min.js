class DEF_Bluesky_SavePost_Manage{removePostInSavedPost(link_post){try{let data_savedPost=SavedPostDataManager.getSavedPostArray(),data_new=[],found=!1;for(let i=0;i<data_savedPost.length;i++){let post_now=data_savedPost[i];post_now.postLink!=link_post&&data_new.push(post_now)}SavedPostDataManager.SaveData(data_new)}catch(error){console.error(`${error}.\n ${error.stack}`)}}ShowNumSavedPost(){try{let list_savedPost=SavedPostDataManager.getSavedPostArray(),$numSavedPost;$(".NumSavedPost").text(list_savedPost.length)}catch(error){console.error(`${error}.\n ${error.stack}`)}}ShowSavedPost(){try{Bluesky_SavePost_Manage.ShowNumSavedPost();const divName_panel="panel_SavedPost";let $panel=$("#"+divName_panel);0==$panel.length&&($("<div>",{id:divName_panel,class:"entryContainer"}).appendTo("body"),$panel=$("#"+divName_panel)),$panel.empty();let data_savedPost=SavedPostDataManager.getSavedPostArray();for(let index=0;index<data_savedPost.length;index++){const postData=data_savedPost[index];let template=$("#example_entryDiv").clone();template.removeAttr("id"),template.appendTo($panel),template.find("a").attr("href",postData.postLink);var $gallery=template.find(".gallery").empty(),$closeButton=template.find(".closeIcon");console.assert(1==$closeButton.length,"Failed: $closeButton.length==1",template),$closeButton.on("click",(function(){var $link_post=$(this).parent().find("a");console.assert(1==$link_post.length,"Failed: $link_post.length==1",$(this).parent());var href_post=$link_post.attr("href");Bluesky_SavePost_Manage.removePostInSavedPost(href_post),Bluesky_SavePost_Manage.ShowSavedPost()}));for(let index_img=0;index_img<postData.imgLinks.length;index_img++){const imgUrl=postData.imgLinks[index_img];let img_new=$("<img>",{src:imgUrl}).appendTo($gallery)}}}catch(error){console.error(`${error}.\n ${error.stack}`)}}Adjust_EntryDiv(){try{var list_entryDiv=$(".entryContainer .entryDiv");list_entryDiv.each(index=>{var newIcon;$("#Icon_Heart").clone().attr({class:"saveIcon"}).removeAttr("id","").appendTo($(list_entryDiv.eq(index))).on("click",(function(){$div_this=$(this);var href=$(this).parent().find("a").get(0);let list_savedPost=SavedPostDataManager.getSavedPostArray(),isSaved=!1;for(let index=0;index<list_savedPost.length;index++){const post=list_savedPost[index];if(post.postLink==href){isSaved=!0;break}}isSaved?(removePostInSavedPost(href),ShowSavedPost()):AddSavedPost(href)}))})}catch(error){console.error(`${error}.\n ${error.stack}`)}}downloadData(){try{document.getElementById("downloadBtn").addEventListener("click",()=>{let savedPost=SavedPostDataManager.getSavedPostArray();const content=JSON.stringify(savedPost),blob=new Blob([content],{type:"text/plain;charset=utf-8"}),url=URL.createObjectURL(blob),a=document.createElement("a");a.href=url,a.download="IndieMushroomForest_BlueSky_IndieDev_SavedPost.txt",a.click(),URL.revokeObjectURL(url)})}catch(error){console.error(`${error}.\n ${error.stack}`)}}deleteSavedPosts(){try{$("#button_deleteSavedPost").on("click",(function(){try{confirm("確定要刪除嗎？")&&(SavedPostDataManager.SaveData([]),Bluesky_SavePost_Manage.ShowSavedPost())}catch(error){console.error(`${error}.\n ${error.stack}`)}}))}catch(error){console.error(`${error}.\n ${error.stack}`)}}uploadData(){try{document.getElementById("fileInput").addEventListener("change",(function(event){const file=event.target.files[0];if(!file)return;const reader=new FileReader;reader.onload=function(e){const content=e.target.result;var list_uploaded=JSON.parse(content),list_old=SavedPostDataManager.getSavedPostArray();for(let index=0;index<list_uploaded.length;index++){const post=Object.assign(new DEF_SavedPostEntry,list_uploaded[index]);if(post.IsValid()){let exist;list_old.some(x=>x.postLink==post.postLink)||list_old.push(post)}}SavedPostDataManager.SaveData(list_old),Bluesky_SavePost_Manage.ShowSavedPost()},reader.readAsText(file,"utf-8")}))}catch(error){console.error(`${error}.\n ${error.stack}`)}}Start(){try{this.Adjust_EntryDiv(),this.ShowSavedPost(),this.downloadData(),this.uploadData(),this.deleteSavedPosts()}catch(error){console.error(`${error}.\n ${error.stack}`)}}}var Bluesky_SavePost_Manage=new DEF_Bluesky_SavePost_Manage;Bluesky_SavePost_Manage.Start();